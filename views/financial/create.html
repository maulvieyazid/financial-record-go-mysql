<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tambah catatan Keuangan - IDN</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Bootstrap Icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>
    <div class="container">
        <main class="my-5">
            <div class="d-flex justify-content-center">
                <div class="/financial/add_financial_record" style="width: 600px;">
                    <a href="/home" class="d-flex align-items-center gap-2 h5">
                        <strong>
                            <i class="bi bi-chevron-left"></i>
                            <span>Tambah Data</span>
                        </strong>
                    </a>
                    <div class="card">
                        <div class="card-body">
                            {{ if .error }}
                            <div class="alert alert-danger">{{ .error }}</div>
                            {{ end }}
                            {{ if .success }}
                            <div class="alert alert-success">{{ .success }}</div>
                            {{ end }}
                            <form action="/financial/add_financial_record" method="POST">

                                <div class="mb-3">
                                    <label for="date" class="form-label">Tanggal <span
                                            class="text-danger">*</span></label>
                                    <input type="date"
                                        class="form-control {{ if .validation.Date }} is-invalid {{ end }}" id="date"
                                        name="date" placeholder="Enter date" value="{{ .financial.Date.Format "2006-01-02" }}" />
                                    <div class="invalid-feedback">
                                        {{ .validation.Date }}
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="row">
                                        <label for="type" class="form-label">Tipe<span
                                                class="text-danger">*</span></label>
                                    </div>

                                    <input type="radio" name="type" id="pemasukan" value="pemasukan"
                                    {{ if eq .financial.Type "pemasukan" }}checked{{ end }}>
                                    <label for="pemasukan">Pemasukan</label>

                                    <input type="radio" name="type" id="pengeluaran" value="pengeluaran"
                                    {{ if eq .financial.Type "pengeluaran" }}checked{{ end }}>
                                    <label for="pengeluaran">Pengeluaran</label>

                                    <div class="invalid-feedback">
                                        {{ .validation.Type }}
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="category" class="form-label">Kategori <span
                                            class="text-danger">*</span></label>

                                    <select class="form-control {{ if .validation.Category }} is-invalid {{ end }}"
                                        id="category" name="category">
                                        <option value="" disabled {{ if not .financial.Category }}selected{{ end }}>Pilih Kategori..</option>
                                        <option value="gaji" {{ if eq .financial.Category "gaji" }}selected{{ end }}>Gaji</option>
                                        <option value="tabungan" {{ if eq .financial.Category "tabungan" }}selected{{ end }}>Tabungan</option>
                                        <option value="hibah" {{ if eq .financial.Category "hibah" }}selected{{ end }}>Hibah</option>
                                        <option value="belanja" {{ if eq .financial.Category "belanja" }}selected{{ end }}>Belanja</option>
                                        <option value="jajan" {{ if eq .financial.Category "jajan" }}selected{{ end }}>Jajan</option>
                                        <option value="bensin" {{ if eq .financial.Category "bensin" }}selected{{ end }}>Bensin</option>
                                    </select>

                                    <div class="invalid-feedback">
                                        {{ .validation.Category }}
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="nominal" class="form-label">Nominal <span
                                            class="text-danger">*</span></label>
                                    <input type="number" min="0"
                                        class="form-control {{ if .validation.Nominal }} is-invalid {{ end }}"
                                        id="nominal" name="nominal" placeholder="Enter nominal"
                                        value="{{ .financial.Nominal }}" />
                                    <div class="invalid-feedback">
                                        {{ .validation.Nominal }}
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="description" class="form-label">Keterangan <span
                                            class="text-muted">(optional)</span></label>
                                    <textarea class="form-control"
                                        name="description" id="description"
                                        rows="5">{{ or .financial.Description "" }}</textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="attachment" class="form-label">Attachment <span
                                            class="text-muted">(optional)</span></label>
                                    <input type="file"
                                        class="form-control"
                                        name="foto" accept="image/*" onchange="previewFoto(event)">
                                    <input type="hidden" name="attachment" id="photoBase64" value="{{ or .financial.Attachment "" }}">
                                    <img id="fotoPreview" class="preview-img img-thumbnail d-none mt-2"
                                        alt="Preview Foto" style="max-width: 200px;">
                                </div>

                                <button type="submit" class="btn btn btn-primary">Tambah</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function previewFoto(event) {
            const input = event.target;
            const preview = document.getElementById('fotoPreview');
            const base64Input = document.getElementById('photoBase64');
            const file = input.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove("d-none");
                    base64Input.value = e.target.result.split(',')[1]; // Set base64 ke input hidden
                };
                reader.readAsDataURL(file);
            } else {
                // Jika tidak ada file yang dipilih, set nilai base64 menjadi null
                base64Input.value = null;
                preview.classList.add("d-none");
            }
        }
        document.addEventListener("DOMContentLoaded", function () {
            const photoBase64 = document.getElementById('photoBase64').value;
            const preview = document.getElementById('fotoPreview');

            if (photoBase64) {
                preview.src = "data:image/jpeg;base64," + photoBase64;
                preview.classList.remove("d-none");
            }
        });


        document.addEventListener("DOMContentLoaded", function () {
            const radios = document.querySelectorAll("input[name='type']");
            const select = document.getElementById("category");
            const options = select.querySelectorAll("option");

            // Sembunyikan semua option kecuali placeholder saat pertama kali load
            options.forEach(option => {
                if (option.value !== "") {
                    option.hidden = true;
                }
            });

            radios.forEach(radio => {
                radio.addEventListener("change", function () {
                    let selectedType = this.nextElementSibling.innerText.trim();
                    options.forEach(option => {
                        if (option.value === "") return; // biarkan placeholder tetap terlihat
                        if (selectedType === "Pemasukan") {
                            option.hidden = !(["gaji", "tabungan", "hibah"].includes(option.value));
                        } else if (selectedType === "Pengeluaran") {
                            option.hidden = !(["belanja", "jajan", "bensin"].includes(option.value));
                        }
                    });
                    select.value = "";
                });
            });
        });


    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>